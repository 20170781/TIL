# 3장) HTTP 메시지

### 3.1) 메시지의 흐름

HTTP 메시지는 HTTP 애플리케이션 간에 주고받은 데이터의 블록들이며, 클라이언트, 서버, 프락시 사이를 흐른다.

#### 

#### 3.1.1) 메세지는 원 서버 방향을 인바운드로 하여 송신

- **인바운드**: 클라이언트 → 서버
- **아웃바운드**: 서버 → 클라이언트



#### 3.1.2) 다운스트림으로 흐르는 메시지

요청 메시지냐 응답 메시지냐에 관계 없이 **모든 메시지는 다운스트림으로 흐른다**.

- **업스트림** : 수신자의 업스트림은 발송자
- **다운스트림** : 발송자의 다운스트림은 수신자

<img src="https://user-images.githubusercontent.com/70627979/161385632-d391749f-0de0-484d-b8b8-e65cce5149e5.png" alt="image" style="zoom: 50%;" />



### 3.2) 메시지의 각 부분

각 메시지는 클라이언트로부터의 **요청**이나, 서버로부터의 **응답** 중 하나를 포함한다.

- **시작줄** : 어떤 메시지인지
- **헤더** (HTTP headers + empty line(CRLF)) : 속성
- **본문** (body) : 데이터



#### 3.2.1) 메시지 문법

요청과 응답 모두 기본적인 구조는 같다.

- **요청 메시지(request)**: 웹 서버에 어떤 동작을 요구

  ```
  <메서드> <요청 URL> <버전>
  <헤더>
  
  <엔티티 본문>
  ```

- **응답 메시지(response)**: 요청의 결과를 클라이언트에게 돌려줌

  ```
  <버전> <상태 코드> <사유 구절>
  <헤더>
  
  <엔티티 본문>
  ```



##### 각 부분에 대한 설명

- **시작줄 (Start-Line)**

  - 메서드(method): 클라이언트 측에서 서버가 리소스에 대해 수행해주길 바라는 동작 (GET, POST 등)

  - 요청 URL(request URL): 요청 대상이 되는 리소스를 지칭하는 완전한 URL 또는 URL의 경로 구성요소

  - 버전: 메시지에서 사용 중인 HTTP 버전 (`HTTP/<메이저>.<마이너>`)

  - 상태 코드(status code): 요청 중에 무엇이 일어났는지 설명하는 세 자리 숫자 (200, 404 등)

  - 사유 구절(reason-phrase): 숫자로 된 상태 코드의 의미를 사람이 이해할 수 있게 설명해주는 짧은 문구

- **헤더 (Header)**
  - 헤더들(Headers): `이름: 값` 쌍의 목록,으로 구성된 0개 이상의 헤더들
  - 빈 줄(CRLF): 헤더 목록의 끝과 엔터티 본문의 시작을 시작을 표시
- **본문 (Body)**
  - 임의의 데이터 블록 or None



### 3.3) 메서드 (Method)

| 메서드  | 설명                                                    | 메시지 본문 여부 |
| ------- | ------------------------------------------------------- | ---------------- |
| GET     | 서버에서 어떤 문서를 가져온다                           | no               |
| HEAD    | 서버에서 어떤 문서에 대해 헤더만 가져온다.              | no               |
| POST    | 서버가 처리해야 할 데이터를 보낸다.                     | yes              |
| PUT     | 서버에 요청 메시지의 본문을 저장한다.                   | yes              |
| TRACE   | 메시지가 프락시를 거쳐 서버에 도달하는 과정을 추적한다. | no               |
| OPTIONS | 서버가 어떤 메서드를 수행할 수 있는지 확인한다.         | no               |
| DELETE  | 서버에서 문서를 제거한다.                               | no               |



#### 3.3.1) 안전한 메서드 (Safe Method)

Get, Head 메서드를 사용하는 HTTP 요청의 결과로 서버에 어떤 작용도 없어 안전한 메서드로 볼 수 있다.



#### 3.3.2) HEAD

: GET처럼 행동하지만, 서버는 응답으로 헤더만 돌려줌 (본문 x)

Head를 사용하면

- 리소스를 가져오지 않고도 그에 대해 무엇인가(타입)를 알아 낼 수 있음
- 응답의 상태 코드를 통해, 개체가 존재하는 확인 가능
- 헤더를 확인하여 리소스가 변경되었는지 검사 가능



#### 3.3.3) PUT

: 서버가 요청의 본문을 가지고 요청 URL의 이름대로 새 문서를 만들거나, 이미 URL이 존재한다면 본문을 사용해서 교체하는 것이다. (전체 수정)



#### 3.3.4) POST

: 서버에 입력 데이터를 전송하기 위해 설계됨 (부분 수정)



### 3.4) 상태 코드

| 전체 범위 | 정의된 범위 | 분류            |
| --------- | ----------- | --------------- |
| 100-199   | 100-101     | 정보            |
| 200-299   | 200-206     | 성공            |
| 300-399   | 300-305     | 리다이렉션      |
| 400-499   | 400-415     | 클라이언트 에러 |
| 500-599   | 500-505     | 서버 에러       |



#### 3.4.1) 100-199: 정보성 상태 코드

| 상태 코드 | 사유 구절           | 의미                                                         |
| --------- | ------------------- | ------------------------------------------------------------ |
| 100       | Continue            | 요청의 시작 부분 일부가 받아 들여 졌으며, 클라이언트는 나머지를 계속 이어서 보내야 한다 |
| 101       | Switching Protocols | 클라이언트가 Upgrade 헤더에 나열한 것 중 하나로 서버가 프로토콜을 바꾸었다 |



#### 3.4.2) 220-229: 성공 상태 코드

| 상태 코드 | 사유 구절         | 의미                                                         |
| --------- | ----------------- | ------------------------------------------------------------ |
| 200       | **OK**            | 요청은 정상이고, 엔티티 본문은 요청된 리소스를 포함하고 있다 |
| 201       | **Created**       | 서버 리소스를 생성하라 요청(e.g. POST)을 위한 것             |
| 202       | Accepted          | 요청은 받아 들여졌으나 서버는 아직 그에 대한 어떤 동작도 수행하지 않았다 |
| 203       | Non-Authoritative | Entity Header에 들어있는 정보가 원래 서버가 아닌 리소스의 사본에서 왔다 |
| 204       | **No Content**    | 응답 메시지는 헤더와 상태줄을 포함하지만 본문은 포함하지 않는다 |
| 205       | Reset Content     | 브라우저에게 현재 페이지에 있는 HTML 폼에 채워진 모든 값을 비우라고 말한다 |
| 206       | Partial Content   | 부분 혹은 범위 요청이 성공했다                               |



#### 3.4.3) 300-399: 리다이렉션 코드

리다이렉션 상태 코드는 클라이언트가 관심있어 하는 리소스에 대해 다른 위치를 사용하라고 말해주거나 그 리소스의 내용 대신 다른 대안 응답을 제공한다.

